# ============================================
# SimplePro-v3 API - STAGING ENVIRONMENT
# ============================================
#
# This is a template for staging environment configuration.
# Staging should mirror production as closely as possible
# but with separate infrastructure and more permissive settings
# for testing and debugging.
#
# SECURITY WARNING: Do NOT commit actual secrets to version control.
# Use separate credentials from production.
#
# Last Updated: 2025-10-02
# ============================================

# ============================================
# APPLICATION CONFIGURATION
# ============================================

PORT=3001
NODE_ENV=staging

APP_NAME=SimplePro-v3-Staging
APP_VERSION=3.0.0

# Staging API and Web URLs
API_BASE_URL=https://api-staging.yourdomain.com
WEB_APP_URL=https://staging.yourdomain.com

# ============================================
# DATABASE CONFIGURATION (MongoDB)
# ============================================
#
# Use separate MongoDB instance from production
# Can use less expensive tier for staging
# Should still use strong credentials
# ============================================

# MongoDB Connection URI (use staging database)
MONGODB_URI=

# Alternative Configuration
MONGODB_HOST=
MONGODB_PORT=27017
MONGODB_DATABASE=simplepro_staging
MONGODB_USERNAME=
MONGODB_PASSWORD=

# Connection Pool (can be smaller than production)
MONGODB_POOL_SIZE=20
MONGODB_MAX_IDLE_TIME_MS=60000
MONGODB_SERVER_SELECTION_TIMEOUT_MS=5000

# ============================================
# REDIS CACHE CONFIGURATION
# ============================================
#
# Use separate Redis instance from production
# ============================================

REDIS_HOST=redis-staging.yourdomain.com
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_CONNECT_TIMEOUT=10000

# Cache TTL Settings (same as production)
REDIS_TTL=300
REDIS_SHORT_TTL=60
REDIS_MEDIUM_TTL=300
REDIS_LONG_TTL=3600
REDIS_EXTRA_LONG_TTL=86400
REDIS_MAX_ITEMS=50000

# TLS can be optional for staging if on private network
REDIS_TLS_ENABLED=false
REDIS_CLUSTER_MODE=false

# ============================================
# JWT AUTHENTICATION SECRETS
# ============================================
#
# IMPORTANT: Use different secrets from production
# Still must be 64+ characters and cryptographically random
# Generate with: openssl rand -base64 64 | tr -d '\n'
# ============================================

JWT_SECRET=
JWT_REFRESH_SECRET=

JWT_EXPIRES_IN=2h
JWT_REFRESH_EXPIRES_IN=14d

JWT_ISSUER=staging.yourdomain.com
JWT_AUDIENCE=api-staging.yourdomain.com

# ============================================
# CORS CONFIGURATION
# ============================================

# Staging frontend URLs
ALLOWED_ORIGINS=https://staging.yourdomain.com,https://preview.yourdomain.com
CORS_CREDENTIALS=true

# ============================================
# OBJECT STORAGE (MinIO/S3)
# ============================================
#
# Use separate bucket from production
# Can use same provider with different bucket/credentials
# ============================================

STORAGE_PROVIDER=s3
STORAGE_ENDPOINT=s3.us-east-1.amazonaws.com
STORAGE_PORT=443
STORAGE_ACCESS_KEY=
STORAGE_SECRET_KEY=
STORAGE_USE_SSL=true
STORAGE_BUCKET_NAME=simplepro-staging-storage
STORAGE_REGION=us-east-1
STORAGE_PUBLIC_URL=https://cdn-staging.yourdomain.com

# ============================================
# EMAIL CONFIGURATION (SMTP)
# ============================================
#
# Staging should use test email provider or sandbox mode
# Consider using Mailtrap, MailHog, or provider's sandbox
# ============================================

SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=
SMTP_PASSWORD=

# Use staging-specific email addresses
SMTP_FROM_EMAIL=noreply-staging@yourdomain.com
SMTP_FROM_NAME=SimplePro Staging
SMTP_REPLY_TO=staging-support@yourdomain.com

EMAIL_PROVIDER=sendgrid
EMAIL_NOTIFICATIONS_ENABLED=true

# ============================================
# SMS CONFIGURATION (Twilio)
# ============================================
#
# Use Twilio test credentials or separate staging account
# Consider using Twilio's test phone numbers
# ============================================

TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
TWILIO_PHONE_NUMBER=
TWILIO_VERIFY_SERVICE_SID=

# Can disable SMS in staging to save costs
SMS_NOTIFICATIONS_ENABLED=false

# ============================================
# PUSH NOTIFICATIONS (Firebase Cloud Messaging)
# ============================================
#
# Use separate Firebase project for staging
# ============================================

FIREBASE_PROJECT_ID=
FIREBASE_PRIVATE_KEY=
FIREBASE_CLIENT_EMAIL=
FIREBASE_DATABASE_URL=

PUSH_NOTIFICATIONS_ENABLED=true

# ============================================
# API RATE LIMITING
# ============================================
#
# More permissive than production for testing
# ============================================

RATE_LIMIT_GLOBAL=2000
RATE_LIMIT_AUTH=20
RATE_LIMIT_LOGIN=10

RATE_LIMIT_TIER1=50
RATE_LIMIT_TIER2=200
RATE_LIMIT_TIER3=1000

RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_BLOCK_DURATION_MS=300000

# ============================================
# LOGGING CONFIGURATION
# ============================================
#
# More verbose logging for staging/debugging
# ============================================

LOG_LEVEL=debug
LOG_FORMAT=json
LOG_CONSOLE_ENABLED=true
LOG_FILE_ENABLED=true
LOG_FILE_PATH=/var/log/simplepro/staging-api.log
LOG_FILE_MAX_SIZE=10485760
LOG_FILE_MAX_FILES=5

# Staging CloudWatch Logs
CLOUDWATCH_LOGS_ENABLED=false
CLOUDWATCH_LOG_GROUP=/simplepro/api/staging
CLOUDWATCH_LOG_STREAM=api-server

DATADOG_LOGS_ENABLED=false
DATADOG_API_KEY=

# ============================================
# MONITORING & METRICS
# ============================================

PROMETHEUS_ENABLED=true
PROMETHEUS_METRICS_PATH=/metrics
PROMETHEUS_PORT=9090

HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health

APM_ENABLED=false
APM_PROVIDER=datadog
APM_API_KEY=
APM_APP_NAME=simplepro-api-staging

# ============================================
# SESSION CONFIGURATION
# ============================================

SESSION_SECRET=
SESSION_TTL=604800
SESSION_COOKIE_NAME=simplepro_staging_session
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTP_ONLY=true
SESSION_COOKIE_SAME_SITE=lax
SESSION_COOKIE_DOMAIN=.staging.yourdomain.com

# ============================================
# FILE UPLOAD CONFIGURATION
# ============================================

MAX_FILE_SIZE=52428800
ALLOWED_FILE_TYPES=image/jpeg,image/png,image/gif,image/webp,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
MAX_FILES_PER_UPLOAD=10

# ============================================
# SECURITY CONFIGURATION
# ============================================

HELMET_ENABLED=true
CSP_ENABLED=true
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000
CSRF_ENABLED=true

BCRYPT_ROUNDS=10

PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBER=true
PASSWORD_REQUIRE_SPECIAL_CHAR=true

ACCOUNT_LOCKOUT_ENABLED=true
ACCOUNT_LOCKOUT_ATTEMPTS=10
ACCOUNT_LOCKOUT_DURATION=600

# ============================================
# FEATURE FLAGS
# ============================================

# Swagger and GraphQL Playground can be enabled in staging
ENABLE_SWAGGER=true
ENABLE_GRAPHQL_PLAYGROUND=true

# Debug mode can be enabled for troubleshooting
DEBUG_MODE=false

# Data seeding can be enabled for testing
SEED_DATA=true

WEBSOCKET_ENABLED=true
CREW_AUTO_ASSIGNMENT_ENABLED=true
AUTO_JOB_STATUS_ENABLED=true
NOTIFICATION_RETRY_ENABLED=true
NOTIFICATION_MAX_RETRIES=3

# ============================================
# WEBHOOK CONFIGURATION
# ============================================

WEBHOOK_SECRET=
WEBHOOK_TIMEOUT=10000

# ============================================
# THIRD-PARTY INTEGRATIONS
# ============================================
#
# Use test/sandbox API keys for staging
# ============================================

GOOGLE_MAPS_API_KEY=

# Stripe Test Mode Keys
STRIPE_PUBLIC_KEY=
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=

# Analytics (can use separate properties)
GOOGLE_ANALYTICS_ID=
MIXPANEL_TOKEN=

# ============================================
# BACKUP & DISASTER RECOVERY
# ============================================

BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 3 * * *
BACKUP_RETENTION_DAYS=7
BACKUP_STORAGE_LOCATION=

# ============================================
# TIMEZONE & LOCALIZATION
# ============================================

TZ=UTC
DEFAULT_LOCALE=en-US
SUPPORTED_LOCALES=en-US,es-ES,fr-FR

# ============================================
# ADVANCED CONFIGURATION
# ============================================

NODE_OPTIONS=--max-old-space-size=2048
CLUSTER_MODE_ENABLED=false
CLUSTER_WORKERS=0
SHUTDOWN_TIMEOUT=30000
DNS_CACHE_TTL=300

# ============================================
# STAGING-SPECIFIC SETTINGS
# ============================================

# Enable request/response logging for debugging
ENABLE_REQUEST_LOGGING=true

# Allow test users to bypass rate limiting
TEST_MODE_ENABLED=true

# Test user email domains (comma-separated)
TEST_EMAIL_DOMAINS=test.com,staging.com,example.com

# ============================================
# END OF STAGING CONFIGURATION
# ============================================
